{% extends "layout.html" %}

{% block title %}Ask AI - TerraLegislativePulse{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-md-12">
            <h1>Ask AI Assistant</h1>
            <p class="lead">Use natural language to ask questions about property assessments, valuations, and regulations</p>
        </div>
    </div>
    
    <div class="row">
        <div class="col-lg-12 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="m-0 font-weight-bold">Ask a Question</h5>
                </div>
                <div class="card-body">
                    <form method="POST" class="needs-validation" novalidate>
                        <div class="mb-3">
                            <label for="query" class="form-label">Your Question</label>
                            <textarea class="form-control" id="query" name="query" rows="3" placeholder="e.g., How are residential properties valued in Washington State?" required></textarea>
                            <div class="invalid-feedback">
                                Please enter your question.
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="property_id" class="form-label">Property Context (Optional)</label>
                            <input type="text" class="form-control" id="property_id" name="property_id" 
                                   placeholder="Parcel ID or address for context">
                            <div class="form-text">Add property information to provide context for your question</div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane me-2"></i> Submit Question
                        </button>
                    </form>
                    
                    <!-- Query Response -->
                    {% if query_response %}
                        <div class="query-response">
                            <h5 class="mb-3">
                                <i class="fas fa-robot me-2"></i> AI Assistant Response
                            </h5>
                            
                            <div class="mb-3">
                                <h6>Response:</h6>
                                <div class="p-3 bg-light rounded">
                                    {{ query_response.response|safe }}
                                </div>
                            </div>
                            
                            <div class="small text-muted mt-2">
                                <p>Intent: {{ query_response.intent|replace('_', ' ')|title }} (Confidence: {{ "%.0f"|format(query_response.confidence * 100) }}%)</p>
                                {% if query_response.is_ai_generated %}
                                <p><i class="fas fa-info-circle me-1"></i> This response was generated by Claude AI.</p>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- Example Questions -->
        <div class="col-lg-6 mb-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="m-0 font-weight-bold">Example Questions</h5>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        <button class="list-group-item list-group-item-action example-question" data-question="What factors affect residential property values in Washington State?">
                            What factors affect residential property values in Washington State?
                        </button>
                        <button class="list-group-item list-group-item-action example-question" data-question="How is the cost approach used to value commercial properties?">
                            How is the cost approach used to value commercial properties?
                        </button>
                        <button class="list-group-item list-group-item-action example-question" data-question="What is the difference between assessed value and market value?">
                            What is the difference between assessed value and market value?
                        </button>
                        <button class="list-group-item list-group-item-action example-question" data-question="Find properties with an assessed value over $500,000 in Washington">
                            Find properties with an assessed value over $500,000 in Washington
                        </button>
                        <button class="list-group-item list-group-item-action example-question" data-question="How do recent legislative changes impact agricultural property assessments?">
                            How do recent legislative changes impact agricultural property assessments?
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AI Assistant Info -->
        <div class="col-lg-6 mb-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="m-0 font-weight-bold">About the AI Assistant</h5>
                </div>
                <div class="card-body">
                    <p>The TerraLegislativePulse AI Assistant can help you with:</p>
                    
                    <div class="d-flex mb-3">
                        <div class="me-3">
                            <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                <i class="fas fa-search text-white"></i>
                            </div>
                        </div>
                        <div>
                            <h6 class="mb-1">Property Searches</h6>
                            <p class="text-muted mb-0 small">Find properties by address, parcel ID, or characteristics</p>
                        </div>
                    </div>
                    
                    <div class="d-flex mb-3">
                        <div class="me-3">
                            <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                <i class="fas fa-chart-line text-white"></i>
                            </div>
                        </div>
                        <div>
                            <h6 class="mb-1">Valuation Questions</h6>
                            <p class="text-muted mb-0 small">Understand how properties are valued in Washington State</p>
                        </div>
                    </div>
                    
                    <div class="d-flex mb-3">
                        <div class="me-3">
                            <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                <i class="fas fa-check-circle text-white"></i>
                            </div>
                        </div>
                        <div>
                            <h6 class="mb-1">Data Validation</h6>
                            <p class="text-muted mb-0 small">Learn about data requirements and validation checks</p>
                        </div>
                    </div>
                    
                    <div class="d-flex mb-3">
                        <div class="me-3">
                            <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                <i class="fas fa-landmark text-white"></i>
                            </div>
                        </div>
                        <div>
                            <h6 class="mb-1">Legislative Information</h6>
                            <p class="text-muted mb-0 small">Get insights on how legislation affects property assessments</p>
                        </div>
                    </div>
                    
                    <div class="d-flex">
                        <div class="me-3">
                            <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px;">
                                <i class="fas fa-question-circle text-white"></i>
                            </div>
                        </div>
                        <div>
                            <h6 class="mb-1">General Help</h6>
                            <p class="text-muted mb-0 small">Get assistance with using the platform and understanding property assessment concepts</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Set up example question buttons
        const exampleQuestions = document.querySelectorAll('.example-question');
        const queryTextarea = document.getElementById('query');
        
        exampleQuestions.forEach(button => {
            button.addEventListener('click', function() {
                const question = this.getAttribute('data-question');
                queryTextarea.value = question;
                // Scroll to the query textarea
                queryTextarea.scrollIntoView({ behavior: 'smooth' });
                // Focus the textarea
                queryTextarea.focus();
            });
        });
    });
</script>
{% endblock %}
